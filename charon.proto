syntax = "proto3";

package charon;

import "mnemosyne.proto";

service RPC {
    // Authentication

    rpc Login(LoginRequest) returns (LoginResponse) {};
    rpc Logout(LogoutRequest) returns (LogoutResponse) {};
    rpc IsAuthenticated(IsAuthenticatedRequest) returns (IsAuthenticatedResponse) {};

    // Authorization

    rpc IsGranted(IsGrantedRequest) returns (IsGrantedResponse) {};
    rpc BelongsTo(BelongsToRequest) returns (BelongsToResponse) {};

    // CRUD

    rpc CreateUser(CreateUserRequest) returns (CreateUserResponse) {};
    rpc ModifyUser(ModifyUserRequest) returns (ModifyUserResponse) {};
    rpc GetUser(GetUserRequest) returns (GetUserResponse) {};
    rpc GetUsers(GetUsersRequest) returns (GetUsersResponse) {};
    rpc DeleteUser(DeleteUserRequest) returns (DeleteUserResponse) {};
    rpc ModifyUserPassword(ModifyUserPasswordRequest) returns (ModifyUserPasswordResponse) {};
}

message User {
    int64 id = 1;
    string username = 2;
    string first_name = 3;
    string last_name = 4;
    bool is_superuser = 5;
    bool is_active = 6;
    bool is_staff = 7;
    bool is_confirmed = 8;
    mnemosyne.Timestamp created_at = 9;
    int64 created_by = 10;
    mnemosyne.Timestamp updated_at = 11;
    int64 updated_by = 12;
}

// Login

message LoginRequest {
    string username = 1;
    string password = 2;
}
message LoginResponse {
    mnemosyne.Token token = 1;
}

// Logout

message LogoutRequest {
    mnemosyne.Token token = 1;
}
message LogoutResponse {}

// IsAuthenticated

message IsAuthenticatedRequest {
    mnemosyne.Token token = 1;
}
message IsAuthenticatedResponse {
    bool is_authenticated = 1;
}

// IsGranted

message IsGrantedRequest {
    mnemosyne.Token token = 1;
    int64 user_id = 2;
    string permission = 3;
}
message IsGrantedResponse {
    bool is_granted = 1;
}

// BelongsTo

message BelongsToRequest {}
message BelongsToResponse {}

// CreateUser

message CreateUserRequest {
    string username = 1;
    string plain_password = 2;
    string secure_password = 3;
    string first_name = 4;
    string last_name = 5;
    bool is_superuser = 6;
    bool is_active = 7;
    bool is_staff = 8;
    bool is_confirmed = 9;
}
message CreateUserResponse {
    int64 id = 1;
    mnemosyne.Timestamp created_at = 2;
}

// GetUser

message GetUserRequest {}
message GetUserResponse {
    User user = 1;
}

// GetUsers

message GetUsersRequest {}
message GetUsersResponse {
    repeated User user = 1;
}

// DeleteUser

message DeleteUserRequest {}
message DeleteUserResponse {}

// ModifyUser

message ModifyUserRequest {}
message ModifyUserResponse {}

message ModifyUserPasswordRequest{
    int64 id = 1;
    string plain_password = 2;
    string secure_password = 3;
    bool regenerate = 4;
    bool is_confirmed = 5;
}
message ModifyUserPasswordResponse{
    string generated = 1;
}
